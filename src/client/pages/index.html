<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#0a0a1a">
    <meta property="og:type" content="Game">
    <meta property="og:title" content="BrokenEye">
    <meta property="og:description"
        content="BrokenEye est un jeu interactif qui met √† l'√©preuve vos connaissances musicales.">
    <meta property="og:image" content="./assets/images/brokeneye.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:site_name" content="BrokenEye">
    <title>BrokenEye</title>
    <link rel="stylesheet" href="/styles/style-responsive.css">
    <script src="https://sdk.scdn.co/spotify-player.js"></script>
</head>

<body>
    <!-- Aurora Background Effects -->
    <div class="aurora-bg">
        <div class="aurora-wave"></div>
        <div class="aurora-wave"></div>
        <div class="aurora-wave"></div>
    </div>

    <div class="container">
        <!-- Enhanced Topbar with AutoSwipe Progress -->
        <div class="topbar">
            <div class="topbar-content">
                <div class="input-container">
                    <div class="input-wrapper">
                        <div class="input-glow"></div>
                        <input id="songName" type="text" placeholder="üéØ Tape ta r√©ponse ici..." maxlength="100"
                            autocomplete="off" spellcheck="false" />
                    </div>
                </div>
            </div>
        </div>

        <!-- Enhanced Left Panel - History -->
        <div class="left-panel">
            <div class="panel-header">
                <h3><span class="neon-icon">üìö</span> Historique</h3>
                <!-- Bouton plein √©cran pour mobile -->
                <button id="historyFullscreenBtn" class="history-fullscreen-btn" style="display: none;"
                    onclick="openHistoryFullscreen()" title="Voir l'historique en plein √©cran">
                    <span>‚õ∂</span>
                </button>
                <div class="panel-glow"></div>
            </div>
            <div class="history-content">
                <div class="history-stats">
                    <div class="stat-item">
                        <span class="stat-label">D√©couvertes</span>
                        <span class="stat-value" id="discoveredCount">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Total</span>
                        <span class="stat-value" id="totalCount">0</span>
                    </div>
                </div>
                <div class="history-grid" id="historyGrid">
                    <!-- L'historique sera g√©n√©r√© dynamiquement -->
                </div>
            </div>
        </div>

        <!-- Enhanced Center Panel - Main Game -->
        <div class="center-panel">
            <div class="album-container">
                <div class="album-glow"></div>
                <img id="thumbnail" src="https://i.scdn.co/image/ab67616d00001e029c11e6241d59940a0157c75a"
                    alt="Album Cover" />
                <div class="album-overlay">
                    <div class="mystery-indicator">
                        <span class="mystery-icon">üé≠</span>
                        <span class="mystery-text">Myst√®re</span>
                    </div>
                </div>
            </div>

            <!-- Song Info Display -->
            <div class="song-info">
                <div class="song-title-container">
                    <div id="songTitle" class="song-title">
                        <span class="song-emoji">üéµ</span> <span class="song-text">Chanson myst√®re</span>
                    </div>
                </div>
                <div class="song-artist-container">
                    <div id="songArtist" class="song-artist">
                        <span class="song-emoji">üé§</span> <span class="song-text">Artiste myst√®re</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Enhanced Right Panel - Controls -->
        <div class="right-panel">
            <div class="panel-header">
                <h3><span class="neon-icon">ÔøΩ</span> Contr√¥les</h3>
                <div class="panel-glow"></div>
            </div>

            <!-- Player Info -->
            <div class="player-info" id="playerInfo">
                <div class="player-avatar">
                    <img id="playerAvatar" src="https://i.scdn.co/image/ab6775700000ee850afe9be4724435a51d4644f8"
                        alt="Player" />
                    <div class="avatar-glow"></div>
                </div>
                <div class="player-details">
                    <div id="playerName" class="player-name">MXA</div>
                    <div id="playerStatus" class="player-status">üü¢ En ligne</div>
                </div>
            </div>

            <!-- Menu Items -->
            <div class="menu-items">
                <div id="PlaylistDivBtn" class="menu-item playlist-btn" data-tooltip="Playlist">
                    <span class="menu-icon">üéµ</span>
                    <span class="menu-text">Playlist</span>
                    <div class="menu-glow"></div>
                </div>

                <div id="PlayerDivBtn" class="menu-item player-btn" data-tooltip="Lecteur">
                    <span class="menu-icon">üéß</span>
                    <span class="menu-text">Lecteur</span>
                    <div class="menu-glow"></div>
                </div>

                <div id="OptionsDivBtn" class="menu-item options-btn" data-tooltip="Options">
                    <span class="menu-icon">‚öôÔ∏è</span>
                    <span class="menu-text">Options</span>
                    <div class="menu-glow"></div>
                </div>

                <div id="ReRollDivBtn" class="menu-item options-btn" data-tooltip="Re-roll">
                    <span class="menu-icon">üîÑ</span>
                    <span class="menu-text">Re-roll</span>
                    <div class="menu-glow"></div>
                </div>

                <div id="autoswipe" class="menu-item autoswipe-btn" data-tooltip="AutoSwipe">
                    <span class="menu-icon">ü§ñ</span>
                    <span class="menu-text">AutoSwipe</span>
                    <span id="autoswipeStatus" class="autoswipe-status">‚è∏Ô∏è</span>
                    <div class="menu-glow"></div>
                </div>
<<<<<<< HEAD
                <div id="Github" class="menu-item github-btn">
=======

                <div id="Github" class="menu-item github-btn" data-tooltip="GitHub"
                    onclick="window.open('https://github.com/MXASoundNDEv/MxSpotyBrokenEyeTest', '_blank')">
>>>>>>> 8fa796b (update)
                    <img id="githubIcon" src="https://github.githubassets.com/assets/GitHub-Mark-ea2971cee799.png"
                        alt="GitHub" class="menu-icon">
                    <span class="menu-text">Github</span>
                    <div class="menu-glow"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Overlay pour fermer le dropdown sur mobile -->
    <div class="dropdown-overlay" id="dropdownOverlay"></div>

    <!-- AutoSwipe Progress Bar -->
    <div class="autoswipe-progress-container" id="autoswipeProgressContainer" style="display: none;">
        <div class="autoswipe-label">
            <span class="neon-icon">‚è±Ô∏è</span>
            <span>AutoSwipe</span>
            <span id="autoswipeTimeRemaining" class="time-remaining">10s</span>
        </div>
        <div class="autoswipe-progress-bar">
            <div class="autoswipe-progress-fill" id="autoswipeProgressFill"></div>
            <div class="autoswipe-progress-glow"></div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="/scripts/spotify-debug.js"></script>
    <script type="module" src="/scripts/SpotifyV3.js"></script>
    <script src="/scripts/compatibility-bridge.js"></script>
    <script src="/scripts/Popup.js"></script>
    <script src="/scripts/game.js"></script>

    <!-- Script d'optimisation responsive -->
    <script>
        // Optimisations mobile et gestionnaire GitHub
        document.addEventListener('DOMContentLoaded', () => {
            // D√©tection mobile
            const isMobile = window.innerWidth <= 768 ||
                /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

            if (isMobile) {
                // Classe pour optimisations mobile
                document.body.classList.add('mobile-optimized');

                // Gestion du dropdown menu pour mobile (768px et moins)
                if (window.innerWidth <= 768) {
                    const rightPanel = document.querySelector('.right-panel');
                    const dropdownOverlay = document.getElementById('dropdownOverlay');

                    // Fonction pour ouvrir/fermer le dropdown
                    const toggleDropdown = (e) => {
                        e.stopPropagation();
                        const isOpen = rightPanel.classList.contains('open');

                        if (isOpen) {
                            closeDropdown();
                        } else {
                            openDropdown();
                        }
                    };

                    const openDropdown = () => {
                        rightPanel.classList.add('open');
                        dropdownOverlay.classList.add('active');
                        // Haptic feedback
                        if ('vibrate' in navigator) {
                            navigator.vibrate(10);
                        }
                    };

                    const closeDropdown = () => {
                        rightPanel.classList.remove('open');
                        dropdownOverlay.classList.remove('active');
                    };

                    // Event listeners
                    rightPanel.addEventListener('click', toggleDropdown);
                    dropdownOverlay.addEventListener('click', closeDropdown);

                    // Fermer sur escape
                    document.addEventListener('keydown', (e) => {
                        if (e.key === 'Escape') {
                            closeDropdown();
                        }
                    });

                    // Emp√™cher la propagation des clics sur les menu items
                    const menuItems = document.querySelectorAll('.right-panel .menu-item');
                    menuItems.forEach(item => {
                        item.addEventListener('click', (e) => {
                            e.stopPropagation();
                            // Fermer le dropdown apr√®s avoir cliqu√© sur un √©l√©ment
                            setTimeout(closeDropdown, 200);
                        });
                    });
                }

                // Pr√©venir le zoom sur focus des inputs
                const inputs = document.querySelectorAll('input[type="text"]');
                inputs.forEach(input => {
                    input.style.fontSize = Math.max(16, parseInt(getComputedStyle(input).fontSize)) +
                        'px';
                });

                // Optimisation hauteur viewport pour mobile
                const setVH = () => {
                    const vh = window.innerHeight * 0.01;
                    document.documentElement.style.setProperty('--vh', `${vh}px`);
                };
                setVH();
                window.addEventListener('resize', setVH);
                window.addEventListener('orientationchange', () => setTimeout(setVH, 100));

                // Re-initialiser les contr√¥les selon la nouvelle taille
                const reinitMobileControls = () => {
                    const rightPanel = document.querySelector('.right-panel');
                    const dropdownOverlay = document.getElementById('dropdownOverlay');

                    // Nettoyer les anciens event listeners et classes
                    rightPanel.classList.remove('open');
                    dropdownOverlay.classList.remove('active');

                    // Re-d√©tecter et r√©initialiser
                    if (window.innerWidth <= 768) {
                        // R√©appliquer la logique dropdown
                        console.log('üîÑ Dropdown activ√© pour largeur:', window.innerWidth);
                    } else {
                        console.log('üîÑ Mode desktop activ√© pour largeur:', window.innerWidth);
                    }
                };

                window.addEventListener('resize', reinitMobileControls);
                window.addEventListener('orientationchange', () => setTimeout(reinitMobileControls, 200));

                // Haptic feedback pour les interactions
                if ('vibrate' in navigator) {
                    const interactiveElements = document.querySelectorAll('.menu-item, button, input');
                    interactiveElements.forEach(el => {
                        el.addEventListener('touchstart', () => navigator.vibrate(10));
                    });
                }

                // Optimisation pour iOS
                if (/iPhone|iPad|iPod/i.test(navigator.userAgent)) {
                    document.documentElement.style.setProperty('--safe-area-top', 'env(safe-area-inset-top)');
                    document.documentElement.style.setProperty('--safe-area-bottom',
                        'env(safe-area-inset-bottom)');
                }

                window.addEventListener("resize", () => {
                    const topbar = document.querySelector(".topbar");
                    if (window.innerHeight < 500) {
                        topbar.style.position = "absolute";
                    } else {
                        topbar.style.position = "fixed";
                    }
                });

                console.log('üéØ Optimisations mobile activ√©es');
            }

<<<<<<< HEAD
            // Gestion des clics sur les menu items mobiles (menu flottant)
            if (isMobile) {
                const menuItems = document.querySelectorAll('.right-panel .menu-item');
                menuItems.forEach(item => {
                    item.addEventListener('click', (e) => {
                        e.stopPropagation();
                        // Animation de feedback
                        item.style.transform = 'scale(0.9)';
                        setTimeout(() => {
                            item.style.transform = '';
                        }, 150);
                    });
                });
            }

            // Gestionnaire pour le bouton GitHub (compatible production/Podman)
            const githubBtn = document.getElementById('Github');
            if (githubBtn) {
                githubBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    const githubUrl = 'https://github.com/MXASoundNDEv/MxSpotyBrokenEyeTest';
                    
                    // Tentative d'ouverture dans un nouvel onglet
                    try {
                        // M√©thode 1: window.open avec fallback
                        const newWindow = window.open(githubUrl, '_blank', 'noopener,noreferrer');
                        
                        // Si window.open √©choue (bloqu√© par le navigateur)
                        if (!newWindow || newWindow.closed || typeof newWindow.closed == 'undefined') {
                            // M√©thode 2: Cr√©er un lien temporaire et le cliquer
                            const link = document.createElement('a');
                            link.href = githubUrl;
                            link.target = '_blank';
                            link.rel = 'noopener noreferrer';
                            document.body.appendChild(link);
                            link.click();
                            document.body.removeChild(link);
                        }
                    } catch (error) {
                        console.warn('Erreur lors de l\'ouverture du lien GitHub:', error);
                        
                        // M√©thode 3: Fallback - redirection dans le m√™me onglet
                        if (confirm('Ouvrir le repository GitHub ? (Cela vous redirigera vers GitHub)')) {
                            window.location.href = githubUrl;
                        }
                    }
                });
                
                // Feedback visuel pour le bouton
                githubBtn.addEventListener('mouseenter', () => {
                    githubBtn.style.transform = 'translateY(-2px)';
                });
                
                githubBtn.addEventListener('mouseleave', () => {
                    githubBtn.style.transform = 'translateY(0)';
                });
                
                // Feedback tactile sur mobile
                if ('vibrate' in navigator) {
                    githubBtn.addEventListener('touchstart', () => {
                        navigator.vibrate(10);
                    });
                }
            }
=======
            // Gestion des clics sur les menu items mobiles (plus utilis√© car tout est en dropdown maintenant)
            // Cette section n'est plus n√©cessaire car on utilise le dropdown pour tous les mobiles
>>>>>>> 8fa796b (update)
        });

        // Fonction utilitaire pour tester le responsive
        window.testResponsive = () => {
            console.log('üì± Test responsive:');
            console.log('Largeur:', window.innerWidth);
            console.log('Hauteur:', window.innerHeight);
            console.log('Mobile:', window.innerWidth <= 768);
            console.log('Orientation:', window.innerHeight > window.innerWidth ? 'Portrait' : 'Paysage');

            // Test de redimensionnement
            const sizes = [{
                width: 1920,
                height: 1080,
                name: 'Desktop Large'
            },
            {
                width: 1366,
                height: 768,
                name: 'Desktop'
            },
            {
                width: 1024,
                height: 768,
                name: 'Tablet Landscape'
            },
            {
                width: 768,
                height: 1024,
                name: 'Tablet Portrait'
            },
            {
                width: 414,
                height: 896,
                name: 'iPhone Large'
            },
            {
                width: 375,
                height: 667,
                name: 'iPhone'
            },
            {
                width: 320,
                height: 568,
                name: 'iPhone Small'
            }
            ];

            console.log('Tailles de test disponibles:', sizes.map(s => s.name));
        };

        // Auto-test au chargement
        setTimeout(() => {
            if (window.testResponsive) window.testResponsive();
        }, 1000);
    </script>

</body>

</html>